<!doctype html>
<!-- Copyright Josh Gardiner 2015 All rights reserved -->
<!-- Based on Australian Communications and Media Authority information -->
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
		<title>All the Radios</title>
		<style>
			html, body, #map-div {
				margin: 0;
				padding: 0;
				height: 100%;
			}
			.acma
			{  
				width: 100%;
				margin-bottom: 11px;
				display: table-cell;   
				opacity:0.6;
				position: fixed;
				bottom: 0px;
			}
			.acma p
			{
				text-align: center;
				font: 10px arial, sans-serif;
			}
		</style>
		<script src="https://maps.googleapis.com/maps/api/js?v=3.20"></script>
		<script src="CanvasLayer.js"></script>
		<script>

		// One to one
		var resolutionScale = window.devicePixelRatio || 1;
		var map;
		var canvasLayer;
		var gl;
		var ws;
		var pointDataSize = 0;
		var pointData = new Float32Array(pointDataSize);

		function init() {
				var mapOptions = {
					zoom: 5,
					center: new google.maps.LatLng(-39.3, 145),
					mapTypeId: google.maps.MapTypeId.ROADMAP,
					styles: [
						{
							"featureType": "all",
							"elementType": "labels.text.fill",
							"stylers": [{"saturation": 35},{"color": "#000000"},{"lightness": 41}]
						},
						{
							"featureType": "all",
							"elementType": "labels.text.stroke",
							"stylers": [{"visibility": "on"},{"color":"#000000"},{"lightness": 15}]
						},
						{
							"featureType": "all",
							"elementType": "labels.icon",
							"stylers": [{"visibility": "off"}]
						},
						{
							"featureType": "administrative",
							"elementType": "geometry.fill",
							"stylers": [{"color": "#000000"},{"lightness": 21}]
						},
						{
							"featureType": "administrative",
							"elementType": "geometry.stroke",
							"stylers": [{"color": "#000000"},{"lightness": 17},{"weight": 1.2}]
						},
						{
							"featureType": "landscape",
							"elementType": "geometry",
							"stylers": [{"color": "#000000"},{"lightness": 21}]
						},
						{
							"featureType": "poi",
							"elementType": "geometry",
							"stylers": [{"color": "#000000"},{"lightness": 22}]
						},
						{
							"featureType": "road.highway",
							"elementType": "geometry.fill",
							"stylers": [{"color": "#000000"},{"lightness": 16}]
						},
						{
							"featureType": "road.highway",
							"elementType": "geometry.stroke",
							"stylers": [{"color": "#000000"},{"lightness": 28},{"weight": 0.2}]
						},
						{
							"featureType": "road.arterial",
							"elementType": "geometry",
							"stylers": [{"color": "#000000"},{"lightness": 18}]
						},
						{
							"featureType": "road.local",
							"elementType": "geometry",
							"stylers": [{"color": "#000000"},{"lightness": 15}]
						},
						{
							"featureType": "transit",
							"elementType": "geometry",
							"stylers": [{"color": "#000000"},{"lightness": 19}]
						},
						{
							"featureType": "water",
							"elementType": "geometry",
							"stylers": [{"color": "#000000"},{"lightness": 17}]
						}
					]
				};
				var mapDiv = document.getElementById('map-div');
				map = new google.maps.Map(mapDiv, mapOptions);
				var canvasLayerOptions = {
					map: map,
					resizeHandler: resize,
					animate: false,
					updateHandler: update,
					resolutionScale: resolutionScale
				};
				canvasLayer = new CanvasLayer(canvasLayerOptions);
				gl = canvasLayer.canvas.getContext('webgl',{premultipliedAlpha: true});
				loadData();
			}
			// get all the datas
			function loadData() {
				ws = new WebSocket("ws://"+document.location.host+"/ws/acmasites");
				ws.binaryType = "arraybuffer";
				ws.onopen = function() {
					console.log("connection open");
					// SendFrame();
				}
				ws.onmessage = function(e) {
					var arrayBuffer = (e.data);
					var data = new DataView(arrayBuffer);
					var tempArray = new Float32Array( data.byteLength / Float32Array.BYTES_PER_ELEMENT);
					var len = tempArray.length;
					for (var jj = 0; jj < len; ++jj) {
						// float32 little-endian byte ordering.
						tempArray[jj] =	data.getFloat32(jj * Float32Array.BYTES_PER_ELEMENT, true);
					}
					// console.log(tempArray);
				}
			}

			function appendData(newData){
				// var currentLength = pointData.length;
				// console.log("Current Lenght: " + currentLength);
				// var newDataLength = newData.length;
				// console.log("Current Lenght: " + currentLength);
				// console.

			}

			// Runs Every Time Map resizes
			function resize() {

			}

			// Runs Every Time Map updates
			function update() {
			}
			// Load that map
			document.addEventListener('DOMContentLoaded', init, false);
		</script>
	</head>

	<body>
		<div id="map-div"></div>
		<div class="acma">
			<p>Data Based on Australian Communications and Media Authority information.</p>
		</div>
	</body>
</html>